<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupo Marcelo Murilo: Perfil dos Participantes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            color: #2d3748;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 1.5rem; }
        .loading { text-align: center; padding: 4rem 2rem; font-size: 1.5rem; color: #667eea; }

        .form-callout {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem auto 0;
            max-width: 700px;
            text-align: center;
        }
        
        .form-callout p {
            font-size: 1rem;
            margin-bottom: 1rem;
            opacity: 0.95;
        }
        
        .form-button {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.9rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .stats-bar {
            background: white;
            padding: 2rem;
            display: flex;
            justify-content: center;
            gap: 3rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        .stat-item { text-align: center; }
        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #718096;
            text-transform: uppercase;
            margin-top: 0.5rem;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 3rem 2rem; }
        .section {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1a202c;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon { font-size: 2rem; }

        .insight {
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
            font-size: 1.05rem;
        }

        .insight strong { color: #667eea; font-weight: 600; }

        .chart-container { position: relative; height: 400px; margin-top: 2rem; }
        .chart-container.tall { height: 500px; }
        .chart-container.short { height: 300px; }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Estilos do Diret√≥rio */
        .directory-header {
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border-left: 4px solid #667eea;
        }

        .directory-header h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #1a202c;
        }

        .directory-header p {
            font-size: 1.05rem;
            color: #4a5568;
        }

        .directory-header .count {
            color: #667eea;
            font-weight: 700;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .result-count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .directory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .directory-table thead {
            background: #f7fafc;
        }

        .directory-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        .directory-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        .directory-table tbody tr:hover {
            background: #f7fafc;
        }

        .linkedin-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #0077b5;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .linkedin-link:hover {
            color: #005885;
        }

        .linkedin-icon {
            width: 20px;
            height: 20px;
        }

        .update-time {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-top: 1rem;
        }

        .footer { text-align: center; padding: 3rem 2rem; color: #718096; font-size: 0.9rem; }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .stats-bar { gap: 1.5rem; }
            .stat-number { font-size: 2rem; }
            .section { padding: 1.5rem; }
            .section-title { font-size: 1.4rem; }
            .grid-2 { grid-template-columns: 1fr; }
            .chart-container { height: 350px; }
            .filters { grid-template-columns: 1fr; }
            
            .directory-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Grupo Marcelo Murilo<br><span style="font-size: 0.8em; font-weight: 500;">Perfil dos Participantes</span></h1>
        <p class="subtitle">An√°lise completa da pesquisa realizada com o grupo de conselheiros e executivos em transi√ß√£o</p>
        <div class="form-callout">
            <p>üìã Se voc√™ ainda n√£o preencheu seu question√°rio de perfil e n√£o consta destes resultados e do diret√≥rio, preencha agora!</p>
            <a href="https://forms.gle/j9aLnbtxDWuBsW2CA" target="_blank" class="form-button">Preencher Question√°rio</a>
        </div>
    </div>

    <div id="loading" class="loading">Carregando dados...</div>

    <div id="content" style="display: none;">
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalParticipantes">0</div>
                <div class="stat-label">Respostas</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="linkedinPct">0%</div>
                <div class="stat-label">Via LinkedIn</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="saoPauloPct">0%</div>
                <div class="stat-label">S√£o Paulo</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="semConselhoPct">0%</div>
                <div class="stat-label">Ainda sem conselho</div>
            </div>
        </div>

        <div class="container" id="sections"></div>

        <div class="footer">
            <p><strong>Grupo Marcelo Murilo</strong> ‚Ä¢ An√°lise com dados em tempo real</p>
            <div class="update-time" id="updateTime">Carregando...</div>
            <p style="margin-top: 1rem; opacity: 0.7;">Dados atualizados automaticamente da planilha Google</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyN-6B0G1xmAeUSCA_ACzMOzYZQ7Xe9pxp1bObwVv3rUHDNDWNQijQcd40utYx3rdXu4w/exec';
        
        Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
        Chart.defaults.color = '#2d3748';
        
        const chartColors = {
            primary: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#38f9d7', '#fa709a', '#fee140'],
        };

        let allCharts = {};
        let allParticipants = [];

        function countValues(data, column) {
            const counts = {};
            data.forEach(row => {
                const val = row[column];
                if (val && String(val).trim()) {
                    counts[String(val).trim()] = (counts[String(val).trim()] || 0) + 1;
                }
            });
            return counts;
        }

        function countMultipleValues(data, column, separator = ',') {
            const counts = {};
            data.forEach(row => {
                const val = row[column];
                if (val && String(val).trim()) {
                    String(val).split(separator).forEach(item => {
                        const trimmed = item.trim();
                        if (trimmed) {
                            counts[trimmed] = (counts[trimmed] || 0) + 1;
                        }
                    });
                }
            });
            return counts;
        }

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                console.log('Dados carregados:', data.length, 'registros');
                
                processAllData(data);

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #e53e3e;">
                        ‚ö†Ô∏è Erro ao carregar dados<br>
                        <small>${error.message}</small><br>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        function processAllData(data) {
            // Preparar dados dos participantes para o diret√≥rio
            allParticipants = data
                .filter(row => row['Nome completo'])
                .map(row => ({
                    nome: String(row['Nome completo'] || '').trim(),
                    estado: String(row['Estado onde voc√™ reside'] || '').trim(),
                    setores: String(row['Quais setores voc√™ conhece bem ou j√° atuou?'] || '').trim(),
                    linkedin: String(row['URL do seu perfil no LinkedIn'] || '').trim()
                }))
                .sort((a, b) => a.nome.localeCompare(b.nome, 'pt-BR'));

            // Stats principais
            document.getElementById('totalParticipantes').textContent = allParticipants.length;

            // Processar todos os dados
            const conheceu = countValues(data, 'Como voc√™ conheceu este grupo de conselheiros e executivos em transi√ß√£o?');
            const estados = countValues(data, 'Estado onde voc√™ reside');
            const atuacao = countValues(data, 'Hoje, qual das op√ß√µes melhor descreve sua atua√ß√£o principal?');
            const setores = countMultipleValues(data, 'Quais setores voc√™ conhece bem ou j√° atuou?');
            const formacao = countValues(data, 'Voc√™ j√° participou de algum dos seguintes programas de forma√ß√£o para conselheiros?');
            const investimento = countValues(data, 'Quanto voc√™ estima que j√° investiu at√© agora em forma√ß√£o espec√≠fica para atuar em conselhos?');
            const satisfacao = countValues(data, 'Qual foi seu grau de satisfa√ß√£o com a forma√ß√£o que fez no Brasil (focada em atua√ß√£o como conselheiro)?');
            const imersao = countValues(data, 'Voc√™ j√° participou de alguma imers√£o internacional voltada a conselhos, governan√ßa ou lideran√ßa?');
            const precisa = countMultipleValues(data, 'O que voc√™ acredita que mais precisa neste momento para acelerar sua transi√ß√£o para conselhos?');
            const govFamiliar = countValues(data, 'Voc√™ j√° atuou ou tem interesse em atuar com governan√ßa de empresas familiares?');
            const dias = countMultipleValues(data, 'Quais dias da semana voc√™ tem mais disponibilidade para participar de encontros online com conte√∫do sobre conselhos, governan√ßa e lideran√ßa?');
            const turno = countValues(data, 'Em qual turno voc√™ prefere participar desses encontros online?');

            // Calcular percentuais
            const linkedinPct = Math.round(((conheceu['LinkedIn'] || 0) / allParticipants.length) * 100);
            const spPct = Math.round(((estados['S√£o Paulo'] || 0) / allParticipants.length) * 100);
            const semConselhoPct = Math.round(((atuacao['Atuo como executivo(a) e ainda n√£o participo de conselhos'] || 0) / allParticipants.length) * 100);

            document.getElementById('linkedinPct').textContent = linkedinPct + '%';
            document.getElementById('saoPauloPct').textContent = spPct + '%';
            document.getElementById('semConselhoPct').textContent = semConselhoPct + '%';

            // Criar todas as se√ß√µes
            createAllSections({
                conheceu, estados, atuacao, setores, formacao,
                investimento, satisfacao, imersao, precisa,
                govFamiliar, dias, turno,
                linkedinPct, spPct, semConselhoPct
            });

            // Hor√°rio de atualiza√ß√£o
            const now = new Date().toLocaleString('pt-BR', {
                day: '2-digit', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            document.getElementById('updateTime').textContent = `√öltima atualiza√ß√£o: ${now}`;

            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function createAllSections(stats) {
            const container = document.getElementById('sections');
            container.innerHTML = '';

            const sections = [
                {
                    title: 'ü§ù Como conheceram o grupo',
                    insight: `<strong>${stats.linkedinPct}% dos participantes</strong> conheceram o grupo atrav√©s do LinkedIn, demonstrando a for√ßa da presen√ßa digital e do networking profissional na plataforma.`,
                    chart: createDoughnutChart('conheceuChart', stats.conheceu)
                },
                {
                    title: 'üìç Distribui√ß√£o Geogr√°fica',
                    insight: `S√£o Paulo domina com <strong>${stats.spPct}% dos participantes</strong>, seguido por outros estados estrat√©gicos.`,
                    chart: createBarChart('estadosChart', stats.estados, 10, 'y')
                },
                {
                    title: 'üíº Atua√ß√£o Profissional Atual',
                    insight: `<strong>${stats.semConselhoPct}% s√£o executivos que ainda n√£o participam de conselhos</strong>, representando o maior grupo.`,
                    chart: createBarChart('atuacaoChart', stats.atuacao, 0, 'y', true)
                },
                {
                    title: 'üè¢ Setores de Conhecimento e Atua√ß√£o',
                    insight: `Os participantes demonstram expertise diversificada em m√∫ltiplos setores.`,
                    chart: createBarChart('setoresChart', stats.setores, 10, 'y'),
                    tall: true
                },
                {
                    title: 'üéì Programas de Forma√ß√£o',
                    insight: `A variedade de forma√ß√µes indica a busca por conhecimento especializado.`,
                    chart: createBarChart('formacaoChart', stats.formacao, 0, 'y')
                },
                {
                    title: 'üí∞ Investimento em Forma√ß√£o',
                    insight: `Significativo investimento financeiro demonstrando comprometimento com a transi√ß√£o de carreira.`,
                    chart: createDoughnutChart('investimentoChart', stats.investimento)
                },
                {
                    title: '‚≠ê Satisfa√ß√£o com Forma√ß√£o no Brasil',
                    insight: `√çndices gerais positivos de satisfa√ß√£o com as forma√ß√µes oferecidas.`,
                    chart: createDoughnutChart('satisfacaoChart', stats.satisfacao),
                    short: true
                },
                {
                    title: '‚úàÔ∏è Experi√™ncia Internacional',
                    insight: `Oportunidade significativa de crescimento para programas internacionais.`,
                    chart: createPieChart('imersaoChart', stats.imersao),
                    short: true
                },
                {
                    title: 'üéØ O que mais precisam agora',
                    insight: `<strong>Conex√µes e oportunidades pr√°ticas</strong> s√£o os maiores desafios da transi√ß√£o.`,
                    chart: createBarChart('precisaChart', stats.precisa, 0, 'y'),
                    tall: true
                },
                {
                    title: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Interesse em Governan√ßa Familiar',
                    insight: `Mercado significativo e em crescimento no Brasil.`,
                    chart: createDoughnutChart('govFamiliarChart', stats.govFamiliar),
                    short: true
                },
                {
                    title: 'üìÖ Melhor Hor√°rio para Encontros',
                    insight: `O per√≠odo da noite √© preferido, e os dias de meio de semana s√£o os mais convenientes.`,
                    chart: createDisponibilidadeCharts(stats.dias, stats.turno),
                    isGrid: true
                },
                {
                    title: 'üë• Diret√≥rio de Participantes',
                    directory: true
                }
            ];

            sections.forEach(section => {
                const div = document.createElement('div');
                div.className = 'section';
                
                let content = `
                    <h2 class="section-title"><span class="section-icon">${section.title.split(' ')[0]}</span> ${section.title.substring(section.title.indexOf(' ') + 1)}</h2>
                `;

                if (section.directory) {
                    content += createDirectory();
                } else {
                    content += `<div class="insight">${section.insight}</div>`;
                    
                    if (section.isGrid) {
                        content += section.chart;
                    } else {
                        const heightClass = section.tall ? 'tall' : section.short ? 'short' : '';
                        content += `<div class="chart-container ${heightClass}"><canvas id="${section.chart.id}"></canvas></div>`;
                    }
                }

                div.innerHTML = content;
                container.appendChild(div);

                if (section.chart && !section.directory && !section.isGrid) {
                    setTimeout(() => section.chart.create(), 100);
                } else if (section.directory) {
                    setTimeout(() => initializeDirectory(), 100);
                }
            });
        }

        function createDirectory() {
            // Extrair estados e setores √∫nicos
            const estados = [...new Set(allParticipants.map(p => p.estado).filter(e => e))].sort();
            const todosSetores = new Set();
            allParticipants.forEach(p => {
                p.setores.split(',').forEach(s => {
                    const trimmed = s.trim();
                    if (trimmed) todosSetores.add(trimmed);
                });
            });
            const setores = [...todosSetores].sort();

            return `
                <div class="directory-header">
                    <h3>üë• Diret√≥rio de Participantes</h3>
                    <p>Conecte-se com os <span class="count">${allParticipants.length} profissionais</span> que fazem parte do Grupo Marcelo Murilo. Use os filtros abaixo para encontrar participantes por estado ou √°rea de atua√ß√£o.</p>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Filtrar por Estado</label>
                        <select id="filterEstado">
                            <option value="">Todos os Estados</option>
                            ${estados.map(e => `<option value="${e}">${e}</option>`).join('')}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Filtrar por Setor</label>
                        <select id="filterSetor">
                            <option value="">Todos os Setores</option>
                            ${setores.map(s => `<option value="${s}">${s}</option>`).join('')}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Buscar por Nome</label>
                        <input type="text" id="searchNome" placeholder="Digite o nome...">
                    </div>
                </div>

                <div class="result-count" id="resultCount">Mostrando ${allParticipants.length} participantes</div>

                <table class="directory-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Estado</th>
                            <th>Setores de Conhecimento</th>
                            <th>LinkedIn</th>
                        </tr>
                    </thead>
                    <tbody id="directoryBody"></tbody>
                </table>
            `;
        }

        function initializeDirectory() {
            renderDirectory(allParticipants);

            document.getElementById('filterEstado').addEventListener('change', filterDirectory);
            document.getElementById('filterSetor').addEventListener('change', filterDirectory);
            document.getElementById('searchNome').addEventListener('input', filterDirectory);
        }

        function fixLinkedInUrl(url) {
            if (!url) return '#';
            
            // Remove espa√ßos extras
            url = url.trim();
            
            // Se come√ßa com http://, trocar por https://
            if (url.startsWith('http://')) {
                return url.replace('http://', 'https://');
            }
            
            // Se j√° tem https://, retorna como est√°
            if (url.startsWith('https://')) {
                return url;
            }
            
            // Se come√ßa com www.linkedin.com ou linkedin.com, adiciona https://
            if (url.startsWith('www.linkedin.com') || url.startsWith('linkedin.com')) {
                return 'https://' + url;
            }
            
            // Se n√£o tem barra (√© apenas um username), constr√≥i a URL completa do LinkedIn
            if (!url.includes('/')) {
                return 'https://www.linkedin.com/in/' + url;
            }
            
            // Caso contr√°rio, assume que precisa do https://
            return 'https://' + url;
        }

        function filterDirectory() {
            const estadoFilter = document.getElementById('filterEstado').value.toLowerCase();
            const setorFilter = document.getElementById('filterSetor').value.toLowerCase();
            const nomeFilter = document.getElementById('searchNome').value.toLowerCase();

            const filtered = allParticipants.filter(p => {
                const matchEstado = !estadoFilter || p.estado.toLowerCase().includes(estadoFilter);
                const matchSetor = !setorFilter || p.setores.toLowerCase().includes(setorFilter);
                const matchNome = !nomeFilter || p.nome.toLowerCase().includes(nomeFilter);
                
                return matchEstado && matchSetor && matchNome;
            });

            renderDirectory(filtered);
        }

        function renderDirectory(participants) {
            const tbody = document.getElementById('directoryBody');
            document.getElementById('resultCount').textContent = `Mostrando ${participants.length} participantes`;

            tbody.innerHTML = participants.map(p => {
                const setoresDisplay = p.setores.split(',').slice(0, 3).join(', ');
                const maisSetores = p.setores.split(',').length > 3 ? ` +${p.setores.split(',').length - 3}` : '';
                
                const linkedinLink = p.linkedin ? 
                    `<a href="${fixLinkedInUrl(p.linkedin)}" target="_blank" class="linkedin-link">
                        <svg class="linkedin-icon" fill="#0077b5" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                        Ver Perfil
                    </a>` : 
                    '-';

                return `
                    <tr>
                        <td>${p.nome}</td>
                        <td>${p.estado || '-'}</td>
                        <td>${setoresDisplay}${maisSetores}</td>
                        <td>${linkedinLink}</td>
                    </tr>
                `;
            }).join('');
        }

        function createDoughnutChart(id, data) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    allCharts[id] = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: chartColors.primary,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } }
                            }
                        }
                    });
                }
            };
        }

        function createPieChart(id, data) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    allCharts[id] = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: chartColors.primary,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { padding: 15, font: { size: 14 } } }
                            }
                        }
                    });
                }
            };
        }

        function createBarChart(id, data, limit = 0, axis = 'y', truncate = false) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    
                    let entries = Object.entries(data).sort((a, b) => b[1] - a[1]);
                    if (limit > 0) entries = entries.slice(0, limit);
                    
                    let labels = entries.map(e => e[0]);
                    if (truncate) labels = labels.map(l => l.length > 50 ? l.substring(0, 50) + '...' : l);
                    
                    allCharts[id] = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels,
                            datasets: [{
                                label: 'Participantes',
                                data: entries.map(e => e[1]),
                                backgroundColor: chartColors.primary[Math.floor(Math.random() * chartColors.primary.length)],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: axis,
                            plugins: { legend: { display: false } },
                            scales: axis === 'y' ? { x: { grid: { display: false } } } : { y: { grid: { display: false } } }
                        }
                    });
                }
            };
        }

        function createDisponibilidadeCharts(dias, turno) {
            setTimeout(() => {
                createBarChart('diasChart', dias, 0, 'x').create();
                createDoughnutChart('turnoChart', turno).create();
            }, 100);

            return `
                <div class="grid-2">
                    <div class="chart-container">
                        <canvas id="diasChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="turnoChart"></canvas>
                    </div>
                </div>
            `;
        }

        // Carregar dados
        loadData();
        
        // Atualizar a cada 5 minutos
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
