<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupo Marcelo Murilo: Perfil dos Participantes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 2rem 1rem;
        }

        /* Header Section com Logo e Tags */
        .header {
            background: white;
            padding: 3rem 2rem 2.5rem;
            text-align: center;
            border-radius: 16px;
            margin: 0 auto 2rem;
            max-width: 1400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .logo-container {
            margin-bottom: 2rem;
        }

        .logo {
            max-width: 280px;
            height: auto;
        }

        h1 { 
            font-size: 2.8rem; 
            font-weight: 700; 
            margin-bottom: 0.5rem; 
            letter-spacing: -0.02em;
            color: #2c3e50;
        }
        
        .subtitle { 
            font-size: 1.5rem; 
            font-weight: 500;
            color: #5a6c7d;
            margin-bottom: 1.5rem;
        }

        .description {
            max-width: 800px;
            margin: 0 auto 2rem;
            font-size: 1rem;
            line-height: 1.7;
            color: #5a6c7d;
        }

        /* Tags/Badges */
        .tags-container {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            flex-wrap: wrap;
            max-width: 1000px;
            margin: 0 auto;
        }

        .tag {
            background: #4a5568;
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 25px;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .loading { text-align: center; padding: 4rem 2rem; font-size: 1.5rem; color: #667eea; }

        /* Statistics Section */
        .stats-bar {
            background: white;
            border-radius: 16px;
            padding: 3rem 2rem;
            margin: 0 auto 2rem;
            max-width: 1400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .stats-title {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }

        .stats-icon-title {
            font-size: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            background: white;
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-align: center;
            border: 2px solid #e8ecf0;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .stat-number {
            font-size: 3.2rem;
            font-weight: 700;
            color: #2c3e50;
            display: block;
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .stats-note {
            text-align: center;
            font-size: 0.75rem;
            color: #999;
            font-style: italic;
            margin-top: 1.5rem;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0; }
        
        .section {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.3s; }
        .section:nth-child(4) { animation-delay: 0.4s; }
        .section:nth-child(5) { animation-delay: 0.5s; }
        .section:nth-child(6) { animation-delay: 0.6s; }
        .section:nth-child(7) { animation-delay: 0.7s; }
        .section:nth-child(8) { animation-delay: 0.8s; }
        .section:nth-child(9) { animation-delay: 0.9s; }
        .section:nth-child(10) { animation-delay: 1.0s; }
        .section:nth-child(11) { animation-delay: 1.1s; }
        .section:nth-child(12) { animation-delay: 1.2s; }
        .section:nth-child(13) { animation-delay: 1.3s; }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon { font-size: 2rem; }

        .insight {
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
            font-size: 1.05rem;
            color: #2d3748;
        }

        .insight strong { color: #667eea; font-weight: 600; }

        .chart-container { position: relative; height: 400px; margin-top: 2rem; }
        .chart-container.tall { height: 500px; }
        .chart-container.short { height: 300px; }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Filtros dos Participantes */
        .filters-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-input, .filter-select {
            padding: 0.75rem;
            border: 2px solid #e8ecf0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .participants-list {
            display: grid;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .participant-card {
            padding: 1.5rem;
            border: 2px solid #e8ecf0;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: white;
        }

        .participant-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .participant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }

        .participant-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }

        .participant-linkedin {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: #0077b5;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .participant-linkedin:hover {
            background: #005582;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 119, 181, 0.3);
        }

        .linkedin-icon {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .participant-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .participant-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #5a6c7d;
        }

        .participant-detail-icon {
            font-size: 1rem;
        }

        .participant-areas {
            margin-top: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .area-tag {
            padding: 0.25rem 0.75rem;
            background: #e8ecf0;
            color: #2c3e50;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #718096;
            font-size: 1.1rem;
        }

        .results-count {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .update-time {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-top: 1rem;
        }

        /* Footer */
        .footer {
            background: white;
            text-align: center;
            padding: 2rem;
            margin: 2rem auto 0;
            max-width: 1400px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .footer-logo {
            max-width: 150px;
            height: auto;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .footer-text {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            body { padding: 1rem 0.5rem; }
            h1 { font-size: 2rem; }
            .subtitle { font-size: 1.2rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .stat-number { font-size: 2.5rem; }
            .section { padding: 1.5rem; }
            .section-title { font-size: 1.4rem; }
            .grid-2 { grid-template-columns: 1fr; }
            .chart-container { height: 350px; }
            .filters-container { grid-template-columns: 1fr; }
            .participant-header { flex-direction: column; align-items: flex-start; }
            .participant-linkedin { width: 100%; justify-content: center; }
            .tags-container { gap: 0.6rem; }
            .tag { padding: 0.5rem 1rem; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <img src="Logo_Preto_2.png" alt="Marcelo Murilo" class="logo">
        </div>
        
        <h1>Grupo de Discussão</h1>
        <p class="subtitle">Marcelo Murilo</p>
        
        <p class="description">
            Análise completa da pesquisa realizada com o grupo de conselheiros e executivos em transição e diretório de participantes
        </p>

        <div class="tags-container">
            <div class="tag">Governança Corporativa</div>
            <div class="tag">Networking Executivo</div>
            <div class="tag">Conselhos de Administração</div>
            <div class="tag">Desenvolvimento de Liderança</div>
            <div class="tag">Comunidade Premium</div>
        </div>
    </div>

    <div id="loading" class="loading">Carregando dados da planilha...</div>

    <div id="content" style="display: none;">
        <div class="stats-bar">
            <h2 class="stats-title">
                <span class="stats-icon-title">📊</span>
                Estatísticas do Grupo
            </h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-icon">👥</span>
                    <div class="stat-number" id="totalParticipantes">0</div>
                    <div class="stat-label">Participantes Cadastrados</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">💼</span>
                    <div class="stat-number" id="linkedinPct">0%</div>
                    <div class="stat-label">Conectados via LinkedIn*</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">📍</span>
                    <div class="stat-number" id="saoPauloPct">0%</div>
                    <div class="stat-label">Baseados em São Paulo*</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">🎯</span>
                    <div class="stat-number" id="semConselhoPct">0%</div>
                    <div class="stat-label">Em Transição para Conselhos*</div>
                </div>
            </div>
            <p class="stats-note">* Percentuais referentes aos participantes cadastrados no diretório</p>
        </div>

        <div class="container" id="sections"></div>

        <div class="footer">
            <img src="Logo_Preto_2.png" alt="Marcelo Murilo" class="footer-logo">
            <p class="footer-text"><strong>Grupo Marcelo Murilo</strong> • Grupo de Discussão em Governança Corporativa</p>
            <div class="update-time" id="updateTime">Carregando...</div>
            <p class="footer-text" style="margin-top: 1rem; opacity: 0.7;">Dados atualizados automaticamente da planilha Google</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyN-6B0G1xmAeUSCA_ACzMOzYZQ7Xe9pxp1bObwVv3rUHDNDWNQijQcd40utYx3rdXu4w/exec';
        
        Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
        Chart.defaults.color = '#2d3748';
        
        const chartColors = {
            primary: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#38f9d7', '#fa709a', '#fee140'],
        };

        let allCharts = {};
        let allParticipants = [];

        // Função para normalizar strings (remove acentos e converte para lowercase)
        function normalizeString(str) {
            if (!str) return '';
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase().trim();
        }

        // Função para normalizar URL do LinkedIn
        function normalizeLinkedInUrl(url) {
            if (!url || !String(url).trim()) return '';
            
            const urlStr = String(url).trim();
            
            // Se já começa com https://, retorna como está
            if (urlStr.startsWith('https://')) {
                return urlStr;
            }
            
            // Se começa com http://, substitui por https://
            if (urlStr.startsWith('http://')) {
                return urlStr.replace('http://', 'https://');
            }
            
            // Se começa com www., adiciona https://
            if (urlStr.startsWith('www.')) {
                return 'https://' + urlStr;
            }
            
            // Se começa com linkedin.com, adiciona https://www.
            if (urlStr.startsWith('linkedin.com')) {
                return 'https://www.' + urlStr;
            }
            
            // Se parece ser apenas o username (sem barras ou pontos no início)
            // assume que é linkedin.com/in/username
            if (!urlStr.includes('/') && !urlStr.includes('.')) {
                return 'https://www.linkedin.com/in/' + urlStr;
            }
            
            // Se contém linkedin.com mas não tem protocolo
            if (urlStr.includes('linkedin.com')) {
                return 'https://' + urlStr.replace(/^\/+/, '');
            }
            
            // Caso padrão: assume que é um username
            return 'https://www.linkedin.com/in/' + urlStr;
        }

        // Função para normalizar nome de categoria
        function normalizeCategory(category) {
            if (!category || !String(category).trim()) return '';
            
            const normalized = normalizeString(String(category));
            
            // Mapa extenso de categorias normalizadas
            const categoryMap = {
                'logistica': 'Logística',
                'tecnologia': 'Tecnologia',
                'ti': 'TI',
                'tecnologia da informacao': 'Tecnologia da Informação',
                'financas': 'Finanças',
                'financeiro': 'Financeiro',
                'saude': 'Saúde',
                'educacao': 'Educação',
                'agricultura': 'Agricultura',
                'agronegocio': 'Agronegócio',
                'industria': 'Indústria',
                'industrial': 'Industrial',
                'servicos': 'Serviços',
                'comercio': 'Comércio',
                'comercial': 'Comercial',
                'construcao': 'Construção',
                'construcao civil': 'Construção Civil',
                'energia': 'Energia',
                'telecom': 'Telecom',
                'telecomunicacoes': 'Telecomunicações',
                'midia': 'Mídia',
                'comunicacao': 'Comunicação',
                'seguros': 'Seguros',
                'imobiliario': 'Imobiliário',
                'automotivo': 'Automotivo',
                'varejo': 'Varejo',
                'consultoria': 'Consultoria',
                'transporte': 'Transporte',
                'transportes': 'Transportes',
                'alimentos': 'Alimentos',
                'alimentos e bebidas': 'Alimentos e Bebidas',
                'bebidas': 'Bebidas',
                'quimico': 'Químico',
                'farmaceutico': 'Farmacêutico',
                'metalurgico': 'Metalúrgico',
                'textil': 'Têxtil',
                'papel': 'Papel',
                'papel e celulose': 'Papel e Celulose',
                'celulose': 'Celulose',
                'rh': 'RH',
                'recursos humanos': 'Recursos Humanos',
                'marketing': 'Marketing',
                'vendas': 'Vendas',
                'operacoes': 'Operações',
                'juridico': 'Jurídico',
                'compliance': 'Compliance',
                'auditoria': 'Auditoria',
                'contabilidade': 'Contabilidade',
                'producao': 'Produção',
                'qualidade': 'Qualidade',
                'supply chain': 'Supply Chain',
                'suprimentos': 'Suprimentos',
                'compras': 'Compras',
                'pos-vendas': 'Pós-vendas',
                'customer success': 'Customer Success',
                'atendimento': 'Atendimento',
                'call center': 'Call Center',
                'sac': 'SAC',
                'facilities': 'Facilities',
                'predial': 'Predial',
                'manutencao': 'Manutenção',
                'engenharia': 'Engenharia',
                'projetos': 'Projetos',
                'pesquisa': 'Pesquisa',
                'desenvolvimento': 'Desenvolvimento',
                'inovacao': 'Inovação',
                'p&d': 'P&D',
                'pesquisa e desenvolvimento': 'Pesquisa e Desenvolvimento',
                'design': 'Design',
                'ux': 'UX',
                'ui': 'UI',
                'produto': 'Produto',
                'mineracao': 'Mineração',
                'petroleo': 'Petróleo',
                'gas': 'Gás',
                'oleo': 'Óleo',
                'oleo e gas': 'Óleo e Gás',
                'bancario': 'Bancário',
                'credito': 'Crédito',
                'investimentos': 'Investimentos',
                'mercado de capitais': 'Mercado de Capitais',
                'private equity': 'Private Equity',
                'venture capital': 'Venture Capital',
                'startups': 'Startups',
                'scale-ups': 'Scale-ups',
                'terceiro setor': 'Terceiro Setor',
                'ongs': 'ONGs',
                'governo': 'Governo',
                'publico': 'Público',
                'administracao publica': 'Administração Pública',
                'setor publico': 'Setor Público'
            };

            return categoryMap[normalized] || String(category).trim();
        }

        function countValues(data, column) {
            const counts = {};
            data.forEach(row => {
                const val = row[column];
                if (val && String(val).trim()) {
                    counts[String(val).trim()] = (counts[String(val).trim()] || 0) + 1;
                }
            });
            return counts;
        }

        function countMultipleValues(data, column, separator = ',') {
            const counts = {};
            data.forEach(row => {
                const val = row[column];
                if (val && String(val).trim()) {
                    String(val).split(separator).forEach(item => {
                        const trimmed = item.trim();
                        if (trimmed) {
                            const normalized = normalizeCategory(trimmed);
                            counts[normalized] = (counts[normalized] || 0) + 1;
                        }
                    });
                }
            });
            return counts;
        }

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                console.log('Dados carregados:', data.length, 'registros');
                
                processAllData(data);

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #e53e3e;">
                        ⚠️ Erro ao carregar dados<br>
                        <small>${error.message}</small><br>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            🔄 Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        function processAllData(data) {
            // Extrair e processar participantes com todas as informações
            allParticipants = data
                .filter(row => row['Nome completo'])
                .map(row => {
                    const setores = String(row['Quais setores você conhece bem ou já atuou?'] || '').trim();
                    // Normalizar setores
                    const setoresNormalizados = setores ? 
                        setores.split(',').map(s => normalizeCategory(s.trim())).filter(s => s).join(', ') : '';

                    // Buscar LinkedIn no campo correto e normalizar a URL
                    const linkedinRaw = String(row['URL do seu perfil no LinkedIn'] || '').trim();
                    const linkedin = normalizeLinkedInUrl(linkedinRaw);

                    return {
                        nome: String(row['Nome completo']).trim(),
                        nomeNormalizado: normalizeString(String(row['Nome completo']).trim()),
                        estado: String(row['Estado onde você reside'] || '').trim(),
                        setores: setoresNormalizados,
                        linkedin: linkedin
                    };
                })
                .sort((a, b) => a.nomeNormalizado.localeCompare(b.nomeNormalizado, 'pt-BR'));

            // Stats principais
            document.getElementById('totalParticipantes').textContent = allParticipants.length;

            // Processar todos os dados
            const conheceu = countValues(data, 'Como você conheceu este grupo de conselheiros e executivos em transição?');
            const estados = countValues(data, 'Estado onde você reside');
            const atuacao = countValues(data, 'Hoje, qual das opções melhor descreve sua atuação principal?');
            const setores = countMultipleValues(data, 'Quais setores você conhece bem ou já atuou?');
            const formacao = countValues(data, 'Você já participou de algum dos seguintes programas de formação para conselheiros?');
            const investimento = countValues(data, 'Quanto você estima que já investiu até agora em formação específica para atuar em conselhos?');
            const satisfacao = countValues(data, 'Qual foi seu grau de satisfação com a formação que fez no Brasil (focada em atuação como conselheiro)?');
            const imersao = countValues(data, 'Você já participou de alguma imersão internacional voltada a conselhos, governança ou liderança?');
            const precisa = countMultipleValues(data, 'O que você acredita que mais precisa neste momento para acelerar sua transição para conselhos?');
            const publica = countValues(data, 'Você já publica conteúdos sobre Governança, Conselhos ou Liderança?');
            const govFamiliar = countValues(data, 'Você já atuou ou tem interesse em atuar com governança de empresas familiares?');
            const dias = countMultipleValues(data, 'Quais dias da semana você tem mais disponibilidade para participar de encontros online com conteúdo sobre conselhos, governança e liderança?');
            const turno = countValues(data, 'Em qual turno você prefere participar desses encontros online?');

            // Calcular percentuais
            const linkedinPct = Math.round(((conheceu['LinkedIn'] || 0) / allParticipants.length) * 100);
            const spPct = Math.round(((estados['São Paulo'] || 0) / allParticipants.length) * 100);
            const semConselhoPct = Math.round(((atuacao['Atuo como executivo(a) e ainda não participo de conselhos'] || 0) / allParticipants.length) * 100);

            document.getElementById('linkedinPct').textContent = linkedinPct + '%';
            document.getElementById('saoPauloPct').textContent = spPct + '%';
            document.getElementById('semConselhoPct').textContent = semConselhoPct + '%';

            // Criar todas as seções
            createAllSections({
                conheceu, estados, atuacao, setores, formacao,
                investimento, satisfacao, imersao, precisa,
                publica, govFamiliar, dias, turno,
                linkedinPct, spPct, semConselhoPct
            });

            // Horário de atualização
            const now = new Date().toLocaleString('pt-BR', {
                day: '2-digit', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            document.getElementById('updateTime').textContent = `Última atualização: ${now}`;

            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function createAllSections(stats) {
            const container = document.getElementById('sections');
            container.innerHTML = '';

            const sections = [
                {
                    title: '🤝 Como conheceram o grupo',
                    insight: `<strong>${stats.linkedinPct}% dos participantes</strong> conheceram o grupo através do LinkedIn, demonstrando a força da presença digital e do networking profissional na plataforma.`,
                    chart: createDoughnutChart('conheceuChart', stats.conheceu)
                },
                {
                    title: '📍 Distribuição Geográfica',
                    insight: `São Paulo domina com <strong>${stats.spPct}% dos participantes</strong>, seguido por outros estados estratégicos.`,
                    chart: createBarChart('estadosChart', stats.estados, 10, 'y')
                },
                {
                    title: '💼 Atuação Profissional Atual',
                    insight: `<strong>${stats.semConselhoPct}% são executivos que ainda não participam de conselhos</strong>, representando o maior grupo.`,
                    chart: createBarChart('atuacaoChart', stats.atuacao, 0, 'y', true)
                },
                {
                    title: '🏢 Setores de Conhecimento e Atuação',
                    insight: `Os participantes demonstram expertise diversificada em múltiplos setores, com destaque para Serviços e Indústria.`,
                    chart: createBarChart('setoresChart', stats.setores, 10, 'y'),
                    tall: true
                },
                {
                    title: '🎓 Programas de Formação',
                    insight: `A variedade de formações indica a busca por conhecimento especializado para atuar em conselhos.`,
                    chart: createBarChart('formacaoChart', stats.formacao, 0, 'y')
                },
                {
                    title: '💰 Investimento em Formação',
                    insight: `Significativo investimento financeiro demonstrando comprometimento com a transição de carreira.`,
                    chart: createDoughnutChart('investimentoChart', stats.investimento)
                },
                {
                    title: '⭐ Satisfação com Formação no Brasil',
                    insight: `Índices gerais positivos de satisfação com as formações oferecidas no mercado brasileiro.`,
                    chart: createDoughnutChart('satisfacaoChart', stats.satisfacao),
                    short: true
                },
                {
                    title: '✈️ Experiência Internacional',
                    insight: `Oportunidade significativa de crescimento para programas internacionais.`,
                    chart: createPieChart('imersaoChart', stats.imersao),
                    short: true
                },
                {
                    title: '🎯 O que mais precisam agora',
                    insight: `Além da formação, <strong>conexões e oportunidades práticas são os maiores desafios</strong> da transição.`,
                    chart: createBarChart('precisaChart', stats.precisa, 0, 'y'),
                    tall: true
                },
                {
                    title: '✍️ Publicação de Conteúdo',
                    insight: `Grande oportunidade para programas de desenvolvimento de autoridade.`,
                    chart: createBarChart('publicaChart', stats.publica, 0, 'y')
                },
                {
                    title: '👨‍👩‍👧‍👦 Interesse em Governança Familiar',
                    insight: `Mercado significativo e em crescimento no Brasil.`,
                    chart: createDoughnutChart('govFamiliarChart', stats.govFamiliar),
                    short: true
                },
                {
                    title: '📅 Melhor Horário para Encontros',
                    insight: `O período da noite é preferido, e os dias de meio de semana são os mais convenientes.`,
                    chart: createDisponibilidadeCharts(stats.dias, stats.turno),
                    isGrid: true
                },
                {
                    title: '👥 Diretório Completo de Participantes',
                    insight: `Total de <strong>${allParticipants.length}</strong> participantes cadastrados. Use os filtros abaixo para encontrar profissionais por estado, área de atuação ou nome.`,
                    list: createParticipantsDirectory()
                }
            ];

            sections.forEach(section => {
                const div = document.createElement('div');
                div.className = 'section';
                
                let content = `
                    <h2 class="section-title"><span class="section-icon">${section.title.split(' ')[0]}</span> ${section.title.substring(section.title.indexOf(' ') + 1)}</h2>
                    <div class="insight">${section.insight}</div>
                `;

                if (section.list) {
                    content += section.list;
                } else if (section.isGrid) {
                    content += section.chart;
                } else {
                    const heightClass = section.tall ? 'tall' : section.short ? 'short' : '';
                    content += `<div class="chart-container ${heightClass}"><canvas id="${section.chart.id}"></canvas></div>`;
                }

                div.innerHTML = content;
                container.appendChild(div);

                if (section.chart && !section.list && !section.isGrid) {
                    setTimeout(() => section.chart.create(), 100);
                }
            });

            // Inicializar filtros de participantes
            setupParticipantsFilters();
        }

        function createParticipantsDirectory() {
            // Obter lista única de estados
            const estados = [...new Set(allParticipants.map(p => p.estado).filter(e => e))].sort();
            
            // Obter lista única de áreas NORMALIZADAS
            const todasAreas = new Set();
            allParticipants.forEach(p => {
                if (p.setores) {
                    p.setores.split(',').forEach(s => {
                        const trimmed = s.trim();
                        if (trimmed) todasAreas.add(trimmed);
                    });
                }
            });
            const areas = [...todasAreas].sort();

            return `
                <div class="filters-container">
                    <div class="filter-group">
                        <label class="filter-label">🔍 Buscar por nome</label>
                        <input type="text" id="filterNome" class="filter-input" placeholder="Digite o nome...">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">📍 Filtrar por estado</label>
                        <select id="filterEstado" class="filter-select">
                            <option value="">Todos os estados</option>
                            ${estados.map(e => `<option value="${e}">${e}</option>`).join('')}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">🏢 Filtrar por área</label>
                        <select id="filterArea" class="filter-select">
                            <option value="">Todas as áreas</option>
                            ${areas.map(a => `<option value="${a}">${a}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="results-count" id="resultsCount">${allParticipants.length} participantes</div>
                <div class="participants-list" id="participantsList"></div>
            `;
        }

        function setupParticipantsFilters() {
            renderParticipants(allParticipants);

            const filterNome = document.getElementById('filterNome');
            const filterEstado = document.getElementById('filterEstado');
            const filterArea = document.getElementById('filterArea');

            const applyFilters = () => {
                const nome = normalizeString(filterNome.value);
                const estado = filterEstado.value;
                const area = filterArea.value;

                const filtered = allParticipants.filter(p => {
                    const matchNome = !nome || p.nomeNormalizado.includes(nome);
                    const matchEstado = !estado || p.estado === estado;
                    const matchArea = !area || p.setores.includes(area);
                    return matchNome && matchEstado && matchArea;
                });

                renderParticipants(filtered);
            };

            filterNome.addEventListener('input', applyFilters);
            filterEstado.addEventListener('change', applyFilters);
            filterArea.addEventListener('change', applyFilters);
        }

        function renderParticipants(participants) {
            const container = document.getElementById('participantsList');
            const countEl = document.getElementById('resultsCount');
            
            countEl.textContent = `${participants.length} participante${participants.length !== 1 ? 's' : ''}`;

            if (participants.length === 0) {
                container.innerHTML = '<div class="no-results">Nenhum participante encontrado com os filtros selecionados.</div>';
                return;
            }

            container.innerHTML = participants.map(p => {
                const areas = p.setores ? p.setores.split(',').map(s => s.trim()).filter(s => s) : [];
                const linkedinBtn = p.linkedin ? 
                    `<a href="${p.linkedin}" target="_blank" rel="noopener noreferrer" class="participant-linkedin">
                        <svg class="linkedin-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                        </svg>
                        LinkedIn
                    </a>` : '';

                return `
                    <div class="participant-card">
                        <div class="participant-header">
                            <div class="participant-name">${p.nome}</div>
                            ${linkedinBtn}
                        </div>
                        <div class="participant-info">
                            ${p.estado ? `
                                <div class="participant-detail">
                                    <span class="participant-detail-icon">📍</span>
                                    <span>${p.estado}</span>
                                </div>
                            ` : ''}
                        </div>
                        ${areas.length > 0 ? `
                            <div class="participant-areas">
                                ${areas.map(area => `<span class="area-tag">${area}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function createDoughnutChart(id, data) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    allCharts[id] = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: chartColors.primary,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } }
                            }
                        }
                    });
                }
            };
        }

        function createPieChart(id, data) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    allCharts[id] = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: chartColors.primary,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { padding: 15, font: { size: 14 } } }
                            }
                        }
                    });
                }
            };
        }

        function createBarChart(id, data, limit = 0, axis = 'y', truncate = false) {
            return {
                id,
                create: () => {
                    const ctx = document.getElementById(id);
                    if (!ctx) return;
                    if (allCharts[id]) allCharts[id].destroy();
                    
                    let entries = Object.entries(data).sort((a, b) => b[1] - a[1]);
                    if (limit > 0) entries = entries.slice(0, limit);
                    
                    let labels = entries.map(e => e[0]);
                    if (truncate) labels = labels.map(l => l.length > 50 ? l.substring(0, 50) + '...' : l);
                    
                    allCharts[id] = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels,
                            datasets: [{
                                label: 'Participantes',
                                data: entries.map(e => e[1]),
                                backgroundColor: chartColors.primary[Math.floor(Math.random() * chartColors.primary.length)],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: axis,
                            plugins: { legend: { display: false } },
                            scales: axis === 'y' ? { x: { grid: { display: false } } } : { y: { grid: { display: false } } }
                        }
                    });
                }
            };
        }

        function createDisponibilidadeCharts(dias, turno) {
            setTimeout(() => {
                createBarChart('diasChart', dias, 0, 'x').create();
                createDoughnutChart('turnoChart', turno).create();
            }, 100);

            return `
                <div class="grid-2">
                    <div class="chart-container">
                        <canvas id="diasChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="turnoChart"></canvas>
                    </div>
                </div>
            `;
        }

        // Carregar dados
        loadData();
        
        // Atualizar a cada 5 minutos
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
